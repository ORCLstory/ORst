# リファクタリング
- commandQueue関連が見づらすぎる
    - target.status.some(function())が見づらい
- 非同期処理を含めたAllyStatusやEnemyStatusが見づらい
- ダメージ計算についても静的メソッドにしていいかも

## battleSystem

1. 全滅判定
1. カーソル、コマンドキューの初期化
1. 味方の行動を選択させる(すべての味方が選択するまで)
    - 決定していたらキューを追加する。
    - キャンセルしていたら最後のキューを削除
1. カーソルの位置の初期化

1. 敵AIの行動を決定

1. カーソルをコマンドライン用に初期化

1. コマンドキューを順番に処理していく
    - キャラクターが行動不能な場合、次のキャラクターに行動させる
    - 対象が選択不能な場合、対象を変える
    1. ダメージ計算
        - 対象にダメージを与える
        - 状態に応じてログを出力する
        - ステータスウィンドウ描画の更新
    1. 行動可能リストの更新
    1. 全滅判定

1. カーソルの初期化


## 味方を回復出来ない
1. ターゲット選択が完全に敵専用になってる。
1. ついでに味方にも攻撃出来るからそれ用に書き直さないといけない
1. systemはローカルなので参照出来ない。
    - グローバルにする？
    - 

## 道具をどうやって実装するか
- 回復(薬草とか)
    - 毒消し系
    - HP回復系
    - MP回復系
- 敵にダメージを与えるもの
- 装備
- 

## 始まりからの処理

1. タイトル画面からスタートする
1. マップ画面で自由探索
    1. 歩いているとランダムエンカウントする
    1. 戦闘が始まる
    1. 戦闘が終わるとマップ画面に戻る

### 考えないと行けないもの
- 画面の描画
- カーソルの位置
- カーソルの動きに応じた処理

## 

タイトル画面
↕
ロード画面
↕
戦闘画面


## もっときれいに
- Sceneクラスを作る？
    - マップ
    - 音楽
    - カーソルの初期化
    - Viewの初期化
    - ロジック
- コードを書く時にこのコードはどこに書くか悩むのが面倒くさい

## memomemo
- next_sceneはくそ
- now_situationとか、
- 戦闘に入る時にどんな戦闘か属性を渡す

scene = new Scene();

class Scene(){
    constractor{
    }
}

### sceneの粒度
- titleProcess()
- battleProcess()
    - ボス戦
    - ノーマル
    - イベント戦
- mapProcess()
    - たくさん動く？(動いて回る)
        - マップを動かせる
        - 飛空艇で飛んでみたり

    - それっぽく？(価値を体験させる)
        - チップセットのタイルを表示
        ***
            {
                id:45,
                name:'草',
                priority:1,
                img_src:'tileset1.png',
                tileX:1,
                tileY:1
            }
        ***
        '草' => 
        - 好きなものをすきなとこにおけるように
            - 床
            - player & npc
            - 山
            - 飛行船
            - 壁
    - モンスターエンカウント
        - 歩くたびにエンカウント率が上昇していく。一歩ごとにエンカウント判定
        - 戦闘終了時に次回のエンカウントする歩数を決めておく。

scene.obj[2].move()
## mapを作る
mapProcessを動かす
- マップを作って
- キャラクターをおいて
- 移動できるようにする
    - キャラクターが動く
    - マップを引く(動いているように見える)
- 

## わかりづらい理由
- 同時並行でプログラムが３つぐらい動いてる
    - animation_frame.js view
    - receive_input.js controller
    - game_process.js models
これはしょうがないんだけど、キチンと住み分けをしないとバグるよね

## バグ
- enemy_pointsをローディング中に読むのはだめ
- Viewに関しては毎フレームanimation_frame.jsが呼ぶ
